(this.webpackJsonpal_madinah=this.webpackJsonpal_madinah||[]).push([[17],{938:function(e,t,n){"use strict";n.r(t);var o,a=n(932),i=n(8),r=n(29),l=n.n(r),c=n(56),d=n(70),s=n(0),u=n(710),b=n(782),j=n(137),p=n(722),m=n.n(p),w=n(725),f=(n(720),n(433)),O=n(90),x=n(718),g=n(717),v=n(781),h=n(95),C=n(82),y=n(1),T=[{store:x.d,name:"customers"}];t.default=Object(h.b)((function(e){var t=e.customers,n=Object(f.a)().t,r=Object(s.createRef)(),h=Object(s.useState)(!1),T=Object(d.a)(h,2),R=T[0],F=T[1],S=Object(s.useState)([]),E=Object(d.a)(S,2),I=E[0],L=E[1],P=function(){var e=Object(c.a)(l.a.mark((function e(t){var n,o,a,i,c,d,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r.current.instance.beginCustomLoading(),!(a=null===(n=t.row)||void 0===n||null===(o=n.data)||void 0===o?void 0:o.billId)){e.next=14;break}return e.next=6,C.a.get("user/bill/".concat(a,"/export/excel"),{responseType:"blob"});case 6:i=e.sent,c=i.data,d=window.URL.createObjectURL(new Blob([c])),(s=document.createElement("a")).href=d,s.setAttribute("download","bill.xlsx"),document.body.appendChild(s),s.click();case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),alert("Export Failed");case 19:return e.prev=19,r.current.instance.endCustomLoading(),e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[0,16,19,22]])})));return function(t){return e.apply(this,arguments)}}();return Object(y.jsxs)(u.a,{basic:!0,children:[Object(y.jsx)(O.d,{title:n("Bills")}),Object(y.jsxs)(u.a,{basic:!0,children:[Object(y.jsxs)(m.a,{ref:r,dataSource:x.a,showBorders:!0,showColumnLines:!0,columnHidingEnabled:!0,wordWrapEnabled:!0,columnAutoWidth:!0,remoteOperations:!0,allowColumnResizing:!0,allowColumnReordering:!0,stateStoring:{enabled:!0,type:"localStorage",storageKey:"BillsDataGridConfigs"},onInitNewRow:function(e){window.onbeforeunload=function(){return"confirm"},o=window.addEventListener("popstate",(function(){alert(n("ConfirmLeaving")),window.onbeforeunload=function(){},window.removeEventListener("popstate",o)})),e.data.at=new Date},onRowValidating:function(e){var t=Object(i.a)(Object(i.a)({},e.oldData),e.newData);if(!t.records||!t.records.length)return j.b.error(n("BillCannotBeEmpty")),e.isValid=!1},loadPanel:{indicatorSrc:g.a},onRowPrepared:function(e){"header"===e.rowType&&(e.rowElement.style.backgroundColor="rgba(55,20,33,0.3)",e.rowElement.style.color="brown",e.rowElement.style.fontWeight="bold"),"data"===e.rowType&&e.rowIndex%2!==0&&(e.rowElement.style.backgroundColor="rgba(55,200,33,0.3)")},onEditingStart:function(e){window.onbeforeunload=function(){return"confirm"},o=window.addEventListener("popstate",(function(){alert(n("ConfirmLeaving")),window.onbeforeunload=function(){},window.removeEventListener("popstate",o)}))},onEditCanceling:function(e){return alert(n("ConfirmLeaving"))},onEditCanceled:function(e){window.onbeforeunload=function(){},o&&window.removeEventListener("popstate",o)},onSaved:function(e){window.onbeforeunload=function(){},o&&window.removeEventListener("popstate",o)},children:[Object(y.jsx)(p.Sorting,{mode:"multiple"}),Object(y.jsx)(p.FilterRow,{visible:!0}),Object(y.jsx)(p.FilterPanel,{visible:!0}),Object(y.jsx)(p.Paging,{defaultPageSize:10}),Object(y.jsx)(p.Pager,{showPageSizeSelector:!0,allowedPageSizes:[10,20,50,100,500,1e3],showInfo:!0,showNavigationButtons:!0}),"                    ",Object(y.jsx)(p.SearchPanel,{visible:!0}),Object(y.jsxs)(p.Editing,{mode:"popup",useIcons:!0,allowAdding:!0,allowUpdating:!0,allowDeleting:!0,children:[Object(y.jsx)(p.Popup,{fullScreen:!0}),Object(y.jsxs)(p.Form,{children:[Object(y.jsxs)(w.Item,{itemType:"group",colCount:2,colSpan:2,children:[Object(y.jsx)(w.Item,{dataField:"at",isRequired:!0,editorType:"dxDateBox",editorOptions:{type:"datetime"}}),Object(y.jsx)(w.Item,{dataField:"customerId",isRequired:!0}),Object(y.jsx)(w.Item,{dataField:"notic",colSpan:2})]}),Object(y.jsx)(w.Item,{itemType:"group",colSpan:2,children:Object(y.jsx)(w.Item,{dataField:"records",isRequired:!0})}),Object(y.jsx)(w.Item,{itemType:"group",colCount:4,colSpan:2,children:Object(y.jsx)(w.Item,{dataField:"finalTotal",editorOptions:{readOnly:!0,format:{type:"fixedPoint"},inputAttr:{style:"background-color: rgba(150,150,20,0.3)"}}})})]})]}),Object(y.jsx)(p.Column,{dataField:"serialNumber",caption:n("SerialNumber"),sortIndex:0,sortOrder:"desc"}),Object(y.jsx)(p.Column,{dataField:"notic",caption:n("Notice")}),Object(y.jsx)(p.Column,{dataField:"at",dataType:"date",caption:n("CreatedAt"),format:{type:"ShortDateShortTime"}}),Object(y.jsxs)(p.Column,{dataField:"customerId",caption:n("Customer"),children:[Object(y.jsx)(p.Lookup,{dataSource:t,displayExpr:"fullName",valueExpr:"idCustomer",allowClearing:!0}),Object(y.jsx)(p.RequiredRule,{})]}),Object(y.jsx)(p.Column,{dataField:"records",visible:!1,caption:n("Records"),allowFiltering:!1,setCellValue:function(e,t,n){var o;e.records=t.updatedBills,e.totalTotal=Math.round(e.records.reduce((function(e,t){return e+t.total}),0));var r=n.addsDiscounts||[];e.addsDiscounts=null===(o=[].concat(Object(a.a)(r),Object(a.a)(t.updatedAddsDiscountsRecords)))||void 0===o?void 0:o.map((function(t){return t.additionRatio&&(t.addition=t.additionRatio*e.totalTotal),t.discountRatio&&(t.discount=t.discountRatio*e.totalTotal),Object(i.a)({},t)})),e.additionsTotal=e.records.reduce((function(e,t){return e+(t.addition||0)}),0),e.discountsTotal=e.records.reduce((function(e,t){return e+(t.discount||0)}),0),e.finalTotal=Math.round(e.records.reduce((function(e,t){return e+t.netPrice}),0)+(e.addedTotal||0))},editCellRender:function(e){return Object(y.jsx)(v.a,{cell:e})}}),Object(y.jsx)(p.Column,{dataField:"totalTotal",visible:!1,allowFiltering:!1,dataType:"number",caption:n("Total")}),Object(y.jsx)(p.Column,{dataField:"additionsTotal",visible:!1,allowFiltering:!1,dataType:"number",caption:n("TotalAdditions")}),Object(y.jsx)(p.Column,{dataField:"discountsTotal",visible:!1,allowFiltering:!1,dataType:"number",caption:n("TotalDiscounts")}),Object(y.jsx)(p.Column,{dataField:"finalTotal",allowFiltering:!1,dataType:"number",format:{type:"fixedPoint"},caption:n("FinalTotal")}),Object(y.jsxs)(p.Column,{type:"buttons",caption:n("Actions"),children:[Object(y.jsx)(p.Button,{name:"edit"}),Object(y.jsx)(p.Button,{name:"delete"}),Object(y.jsx)(p.Button,{hint:n("Records"),icon:"copy",onClick:function(e){L([e.row.data]),F(!0)},visible:function(e){return e.row.data.billId}}),Object(y.jsx)(p.Button,{hint:n("EXPORT"),icon:"xlsxfile",onClick:P,visible:function(e){return e.row.data.billId}})]})]}),Object(y.jsx)(b.a,{onClose:function(){F(!1),L([])},open:R,content:I[0]&&Object(y.jsx)(u.a,{basic:!0,children:Object(y.jsx)(v.a,{cell:I[0],isReadOnly:!0})}),closeIcon:!0,header:n("Records"),size:"fullscreen",centered:!0,closeOnDimmerClick:!1,style:{maxHeight:"95vh",overflow:"auto"}})]})]})}),T)}}]);
//# sourceMappingURL=17.156b6bd8.chunk.js.map
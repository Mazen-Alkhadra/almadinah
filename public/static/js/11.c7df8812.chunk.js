(this.webpackJsonpal_madinah=this.webpackJsonpal_madinah||[]).push([[11],{744:function(t,e,a){"use strict";var i=a(8),n=a(30),o=a.n(n),d=a(55),c=a(70),l=a(0),r=a(710),u=a(720),s=a.n(u),b=a(700),j=a(719),m=a(718),p=a(722),O=a(1);e.a=Object(b.a)()((function(t){var e,a=t.t,n=t.cell,b=t.isReadOnly,f=(null===n||void 0===n||null===(e=n.data)||void 0===e?void 0:e.billId)||n.billId,R=Object(l.createRef)(),x=Object(l.useState)(b?null:n.value||[]),y=Object(c.a)(x,2),C=y[0],T=y[1],F=Object(l.useState)(!1),v=Object(c.a)(F,2),w=v[0],g=v[1],h=function(){var t=Object(d.a)(o.a.mark((function t(){var e,a,i,d,c;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return g(!0),t.prev=1,t.next=4,j.a.getRecords(f);case 4:e=t.sent,a=e.data.data,i=A(a,[]),d=i.updatedBills,c=i.updatedAddsDiscountsRecords,T(d),!b&&n.setValue&&n.setValue(d.length?{updatedBills:d,updatedAddsDiscountsRecords:c}:null),t.next=14;break;case 11:return t.prev=11,t.t0=t.catch(1),t.abrupt("return",t.t0);case 14:return t.prev=14,g(!1),t.finish(14);case 17:case"end":return t.stop()}}),t,null,[[1,11,14,17]])})));return function(){return t.apply(this,arguments)}}(),A=function(t,e){var a=t.map((function(t){var e=t.unitPrice*t.quantity,a=t.discount?t.discount/e:null,n=t.addition?t.addition/e:null,o=P(Object(i.a)(Object(i.a)({},t),{},{total:e,discountRatio:a,additionRatio:n}));return Object(i.a)(Object(i.a)({},t),{},{total:e,discountRatio:a,additionRatio:n,netPrice:o})})),n=a.reduce((function(t,e){return t+e.total}),0);return{updatedBills:a,updatedAddsDiscountsRecords:e.map((function(t){var e=t.discount?t.discount/n:null,a=t.addition?t.addition/n:null;return Object(i.a)(Object(i.a)({},t),{},{discountRatio:e,additionRatio:a})}))}};Object(l.useEffect)((function(){!b&&n.value||f&&h()}),[]);var P=function(t){return t.quantity*t.unitPrice-(t.discount||0)+(t.addition||0)};return w?Object(O.jsx)(r.a,{basic:!0,padded:!0,loading:w}):Object(O.jsxs)(s.a,{ref:R,dataSource:C,showBorders:!0,showColumnLines:!0,columnHidingEnabled:!0,wordWrapEnabled:!0,columnAutoWidth:!0,allowColumnResizing:!0,loadPanel:{indicatorSrc:m.a},onSaved:function(){var t=R.current.instance.getDataSource().items();return n.setValue&&n.setValue({updatedBills:t,updatedAddsDiscountsRecords:[]}),!0},onEditorPreparing:function(t){"dataRow"!==t.parentType||"total"!==t.dataField&&"netPrice"!==t.dataField||(t.editorOptions.disabled=!0)},onRowPrepared:function(t){"data"===t.rowType&&t.key%2!==0&&(t.rowElement.style.backgroundColor="rgba(55,200,33,0.3)")},children:[Object(O.jsx)(u.Sorting,{mode:"multiple"}),Object(O.jsx)(u.Scrolling,{mode:"infinity"}),!b&&Object(O.jsx)(u.Editing,{mode:"batch",useIcons:!0,allowUpdating:!0,allowDeleting:!0,allowAdding:!0}),Object(O.jsx)(u.Column,{dataField:"quantity",dataType:"number",caption:a("Amount"),setCellValue:function(t,e,a){t.quantity=e>0?e:1,t.unitPrice=0,t.total=t.unitPrice*t.quantity,a.additionRatio&&(t.addition=a.additionRatio*t.total),a.discountRatio&&(t.discount=a.discountRatio*t.total),t.netPrice=P(Object(i.a)(Object(i.a)({},a),t))},children:Object(O.jsx)(u.RequiredRule,{})}),Object(O.jsx)(u.Column,{dataField:"unitPrice",caption:a("Price"),dataType:"number",format:p.a.DECIMAL_NUM_FORMAT,setCellValue:function(t,e,a){t.unitPrice=e>=0?e:0,t.total=t.unitPrice*a.quantity,a.additionRatio&&(t.addition=a.additionRatio*t.total),a.discountRatio&&(t.discount=a.discountRatio*t.total),t.netPrice=P(Object(i.a)(Object(i.a)({},a),t))},children:Object(O.jsx)(u.RequiredRule,{})}),Object(O.jsx)(u.Column,{dataField:"total",dataType:"number",caption:a("Total"),format:p.a.DECIMAL_NUM_FORMAT}),Object(O.jsx)(u.Column,{dataField:"discount",format:p.a.DECIMAL_NUM_FORMAT,dataType:"number",caption:a("Discount"),setCellValue:function(t,e,a){t.discount=e>=0?e:0,t.discountRatio=t.discount/a.total,t.netPrice=P(Object(i.a)(Object(i.a)({},a),t))}}),Object(O.jsx)(u.Column,{dataField:"discountRatio",dataType:"number",caption:a("DiscountRatio"),format:"percent",setCellValue:function(t,e,a){t.discountRatio=e>=0?e/100:0,t.discount=t.discountRatio*a.total,t.netPrice=P(Object(i.a)(Object(i.a)({},a),t))}}),Object(O.jsx)(u.Column,{dataField:"addition",dataType:"number",format:p.a.DECIMAL_NUM_FORMAT,caption:a("Addition"),setCellValue:function(t,e,a){t.addition=e>=0?e:0,t.additionRatio=t.addition/a.total,t.netPrice=P(Object(i.a)(Object(i.a)({},a),t))}}),Object(O.jsx)(u.Column,{dataField:"additionRatio",dataType:"number",caption:a("AdditionRatio"),format:"percent",setCellValue:function(t,e,a){t.additionRatio=e>0?e/100:1,t.addition=t.additionRatio*a.total,t.netPrice=P(Object(i.a)(Object(i.a)({},a),t))}}),Object(O.jsx)(u.Column,{dataField:"notice",caption:a("Notice")}),Object(O.jsx)(u.Column,{dataField:"netPrice",dataType:"number",format:p.a.DECIMAL_NUM_FORMAT,caption:a("NetPrice")})]})}))},940:function(t,e,a){"use strict";a.r(e);var i=a(303);var n=a(331);function o(t){return function(t){if(Array.isArray(t))return Object(i.a)(t)}(t)||function(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||Object(n.a)(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var d=a(8),c=(a(0),a(710)),l=a(137),r=a(720),u=a.n(r),s=a(729),b=(a(779),a(433)),j=a(92),m=a(719),p=a(718),O=a(744),f=a(136),R=a(722),x=a(1),y=[{store:m.c,name:"customers"}];e.default=Object(f.b)((function(t){var e=t.customers,a=Object(b.a)().t;return Object(x.jsxs)(c.a,{basic:!0,children:[Object(x.jsx)(j.d,{title:a("Bills")}),Object(x.jsx)(c.a,{basic:!0,children:Object(x.jsxs)(u.a,{dataSource:m.a,showBorders:!0,showColumnLines:!0,columnHidingEnabled:!0,wordWrapEnabled:!0,columnAutoWidth:!0,remoteOperations:!0,onInitNewRow:function(t){t.data.at=new Date,t.component.columnOption("serialNumber","allowEditing",!1)},onRowValidating:function(t){var e=Object(d.a)(Object(d.a)({},t.oldData),t.newData);if(!e.records||!e.records.length)return l.b.error(a("BillCannotBeEmpty")),t.isValid=!1},loadPanel:{indicatorSrc:p.a},onRowPrepared:function(t){"data"===t.rowType&&t.key%2!==0&&(t.rowElement.style.backgroundColor="rgba(55,200,33,0.3)")},children:[Object(x.jsx)(r.Sorting,{mode:"multiple"}),Object(x.jsx)(r.FilterRow,{visible:!0}),Object(x.jsx)(r.FilterPanel,{visible:!0}),Object(x.jsx)(r.Scrolling,{mode:"virtual"}),Object(x.jsx)(r.SearchPanel,{visible:!0}),Object(x.jsxs)(r.Editing,{mode:"popup",useIcons:!0,allowAdding:!0,allowUpdating:!0,allowDeleting:!0,children:[Object(x.jsx)(r.Popup,{fullScreen:!0}),Object(x.jsxs)(r.Form,{customizeItem:function(t){t&&"serialNumber"===t.dataField&&(t.column.allowEditing||(t.visible=!1))},children:[Object(x.jsxs)(s.Item,{itemType:"group",colCount:2,colSpan:2,children:[Object(x.jsx)(s.Item,{dataField:"serialNumber"}),Object(x.jsx)(s.Item,{dataField:"at",isRequired:!0}),Object(x.jsx)(s.Item,{dataField:"customerId",isRequired:!0}),Object(x.jsx)(s.Item,{dataField:"notic",colSpan:2})]}),Object(x.jsx)(s.Item,{itemType:"group",colSpan:2,children:Object(x.jsx)(s.Item,{dataField:"records",isRequired:!0})}),Object(x.jsx)(s.Item,{itemType:"group",colCount:4,colSpan:2,children:Object(x.jsx)(s.Item,{dataField:"finalTotal",editorOptions:{readOnly:!0,format:R.a.DECIMAL_NUM_FORMAT}})})]})]}),Object(x.jsx)(r.Column,{dataField:"serialNumber",caption:a("SerialNumber"),sortIndex:0,sortOrder:"desc"}),Object(x.jsx)(r.Column,{dataField:"at",dataType:"datetime",caption:a("CreatedAt")}),Object(x.jsxs)(r.Column,{dataField:"customerId",caption:a("Customer"),children:[Object(x.jsx)(r.Lookup,{dataSource:e,displayExpr:"fullName",valueExpr:"idCustomer",allowClearing:!0}),Object(x.jsx)(r.RequiredRule,{})]}),Object(x.jsx)(r.Column,{dataField:"notic",caption:a("Notice")}),Object(x.jsx)(r.Column,{dataField:"records",visible:!1,caption:a("Records"),allowFiltering:!1,setCellValue:function(t,e,a){var i;t.records=e.updatedBills,t.totalTotal=t.records.reduce((function(t,e){return t+e.total}),0);var n=a.addsDiscounts||[];t.addsDiscounts=null===(i=[].concat(o(n),o(e.updatedAddsDiscountsRecords)))||void 0===i?void 0:i.map((function(e){return e.additionRatio&&(e.addition=e.additionRatio*t.totalTotal),e.discountRatio&&(e.discount=e.discountRatio*t.totalTotal),Object(d.a)({},e)})),t.additionsTotal=t.records.reduce((function(t,e){return t+(e.addition||0)}),0),t.discountsTotal=t.records.reduce((function(t,e){return t+(e.discount||0)}),0),t.finalTotal=t.records.reduce((function(t,e){return t+e.netPrice}),0)+(t.addedTotal||0)},editCellRender:function(t){return Object(x.jsx)(O.a,{cell:t})}}),Object(x.jsx)(r.Column,{dataField:"totalTotal",visible:!1,allowFiltering:!1,dataType:"number",caption:a("Total")}),Object(x.jsx)(r.Column,{dataField:"additionsTotal",visible:!1,allowFiltering:!1,dataType:"number",caption:a("TotalAdditions")}),Object(x.jsx)(r.Column,{dataField:"discountsTotal",visible:!1,allowFiltering:!1,dataType:"number",caption:a("TotalDiscounts")}),Object(x.jsx)(r.Column,{dataField:"finalTotal",allowFiltering:!1,dataType:"number",caption:a("FinalTotal")}),Object(x.jsx)(r.MasterDetail,{enabled:!0,render:function(t){return Object(x.jsx)(O.a,{cell:t,isReadOnly:!0})}})]})})]})}),y)}}]);
//# sourceMappingURL=11.c7df8812.chunk.js.map
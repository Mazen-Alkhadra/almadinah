(this.webpackJsonpal_madinah=this.webpackJsonpal_madinah||[]).push([[16],{938:function(e,t,o){"use strict";o.r(t);var a=o(932),n=o(8),i=o(29),l=o.n(i),r=o(56),c=o(70),d=o(0),s=o(710),u=o(782),b=o(137),j=o(722),p=o.n(j),m=o(725),O=(o(723),o(433)),x=o(92),w=o(718),f=o(716),g=o(781),h=o(102),C=o(719),T=o(82),y=o(1),v=[{store:w.d,name:"customers"}];t.default=Object(h.b)((function(e){var t=e.customers,o=Object(O.a)().t,i=Object(d.createRef)(),h=Object(d.useState)(!1),v=Object(c.a)(h,2),R=v[0],F=v[1],I=Object(d.useState)([]),S=Object(c.a)(I,2),E=S[0],k=S[1],D=function(){var e=Object(r.a)(l.a.mark((function e(t){var o,a,n,r,c,d,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,i.current.instance.beginCustomLoading(),!(n=null===(o=t.row)||void 0===o||null===(a=o.data)||void 0===a?void 0:a.billId)){e.next=14;break}return e.next=6,T.a.get("user/bill/".concat(n,"/export/excel"),{responseType:"blob"});case 6:r=e.sent,c=r.data,d=window.URL.createObjectURL(new Blob([c])),(s=document.createElement("a")).href=d,s.setAttribute("download","bill.xlsx"),document.body.appendChild(s),s.click();case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),alert("Export Failed");case 19:return e.prev=19,i.current.instance.endCustomLoading(),e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[0,16,19,22]])})));return function(t){return e.apply(this,arguments)}}();return Object(y.jsxs)(s.a,{basic:!0,children:[Object(y.jsx)(x.d,{title:o("Bills")}),Object(y.jsxs)(s.a,{basic:!0,children:[Object(y.jsxs)(p.a,{ref:i,dataSource:w.a,showBorders:!0,showColumnLines:!0,columnHidingEnabled:!0,wordWrapEnabled:!0,columnAutoWidth:!0,remoteOperations:!0,allowColumnResizing:!0,allowColumnReordering:!0,stateStoring:{enabled:!0,type:"localStorage",storageKey:"BillsDataGridConfigs"},onInitNewRow:function(e){e.data.at=new Date},onRowValidating:function(e){var t=Object(n.a)(Object(n.a)({},e.oldData),e.newData);if(!t.records||!t.records.length)return b.b.error(o("BillCannotBeEmpty")),e.isValid=!1},loadPanel:{indicatorSrc:f.a},onRowPrepared:function(e){"header"===e.rowType&&(e.rowElement.style.backgroundColor="rgba(55,20,33,0.3)",e.rowElement.style.color="brown",e.rowElement.style.fontWeight="bold"),"data"===e.rowType&&e.rowIndex%2!==0&&(e.rowElement.style.backgroundColor="rgba(55,200,33,0.3)")},children:[Object(y.jsx)(j.Sorting,{mode:"multiple"}),Object(y.jsx)(j.FilterRow,{visible:!0}),Object(y.jsx)(j.FilterPanel,{visible:!0}),Object(y.jsx)(j.Scrolling,{mode:"virtual"}),Object(y.jsx)(j.SearchPanel,{visible:!0}),Object(y.jsxs)(j.Editing,{mode:"popup",useIcons:!0,allowAdding:!0,allowUpdating:!0,allowDeleting:!0,children:[Object(y.jsx)(j.Popup,{fullScreen:!0}),Object(y.jsxs)(j.Form,{children:[Object(y.jsxs)(m.Item,{itemType:"group",colCount:2,colSpan:2,children:[Object(y.jsx)(m.Item,{dataField:"at",isRequired:!0,editorType:"dxDateBox",editorOptions:{type:"datetime"}}),Object(y.jsx)(m.Item,{dataField:"customerId",isRequired:!0}),Object(y.jsx)(m.Item,{dataField:"notic",colSpan:2})]}),Object(y.jsx)(m.Item,{itemType:"group",colSpan:2,children:Object(y.jsx)(m.Item,{dataField:"records",isRequired:!0})}),Object(y.jsx)(m.Item,{itemType:"group",colCount:4,colSpan:2,children:Object(y.jsx)(m.Item,{dataField:"finalTotal",editorOptions:{readOnly:!0,format:C.a.DECIMAL_NUM_FORMAT,inputAttr:{style:"background-color: rgba(150,150,20,0.3)"}}})})]})]}),Object(y.jsx)(j.Column,{dataField:"serialNumber",caption:o("SerialNumber"),sortIndex:0,sortOrder:"desc"}),Object(y.jsx)(j.Column,{dataField:"notic",caption:o("Notice")}),Object(y.jsx)(j.Column,{dataField:"at",dataType:"date",caption:o("CreatedAt"),format:{type:"ShortDateShortTime"}}),Object(y.jsxs)(j.Column,{dataField:"customerId",caption:o("Customer"),children:[Object(y.jsx)(j.Lookup,{dataSource:t,displayExpr:"fullName",valueExpr:"idCustomer",allowClearing:!0}),Object(y.jsx)(j.RequiredRule,{})]}),Object(y.jsx)(j.Column,{dataField:"records",visible:!1,caption:o("Records"),allowFiltering:!1,setCellValue:function(e,t,o){var i;e.records=t.updatedBills,e.totalTotal=e.records.reduce((function(e,t){return e+t.total}),0);var l=o.addsDiscounts||[];e.addsDiscounts=null===(i=[].concat(Object(a.a)(l),Object(a.a)(t.updatedAddsDiscountsRecords)))||void 0===i?void 0:i.map((function(t){return t.additionRatio&&(t.addition=t.additionRatio*e.totalTotal),t.discountRatio&&(t.discount=t.discountRatio*e.totalTotal),Object(n.a)({},t)})),e.additionsTotal=e.records.reduce((function(e,t){return e+(t.addition||0)}),0),e.discountsTotal=e.records.reduce((function(e,t){return e+(t.discount||0)}),0),e.finalTotal=e.records.reduce((function(e,t){return e+t.netPrice}),0)+(e.addedTotal||0)},editCellRender:function(e){return Object(y.jsx)(g.a,{cell:e})}}),Object(y.jsx)(j.Column,{dataField:"totalTotal",visible:!1,allowFiltering:!1,dataType:"number",caption:o("Total")}),Object(y.jsx)(j.Column,{dataField:"additionsTotal",visible:!1,allowFiltering:!1,dataType:"number",caption:o("TotalAdditions")}),Object(y.jsx)(j.Column,{dataField:"discountsTotal",visible:!1,allowFiltering:!1,dataType:"number",caption:o("TotalDiscounts")}),Object(y.jsx)(j.Column,{dataField:"finalTotal",allowFiltering:!1,dataType:"number",caption:o("FinalTotal")}),Object(y.jsxs)(j.Column,{type:"buttons",caption:o("Actions"),children:[Object(y.jsx)(j.Button,{name:"edit"}),Object(y.jsx)(j.Button,{name:"delete"}),Object(y.jsx)(j.Button,{hint:o("Records"),icon:"copy",onClick:function(e){k([e.row.data]),F(!0)},visible:function(e){return e.row.data.billId}}),Object(y.jsx)(j.Button,{hint:o("EXPORT"),icon:"xlsxfile",onClick:D,visible:function(e){return e.row.data.billId}})]})]}),Object(y.jsx)(u.a,{onClose:function(){F(!1),k([])},open:R,content:E[0]&&Object(y.jsx)(s.a,{basic:!0,children:Object(y.jsx)(g.a,{cell:E[0],isReadOnly:!0})}),closeIcon:!0,header:o("Records"),size:"fullscreen",centered:!0,closeOnDimmerClick:!1,style:{maxHeight:"95vh",overflow:"auto"}})]})]})}),v)}}]);
//# sourceMappingURL=16.14e973bb.chunk.js.map